# Curriculum Endpoints

> Browse, view, and purchase curriculums

## Overview

Curriculums are the top-level content structure. Each curriculum contains multiple chapters, which contain multiple lessons.

**Purchase Model**: Users can only purchase entire curriculums (not individual chapters or lessons).

---

## GET `/api/curriculums`

List all published curriculums.

### Query Parameters

| Parameter | Type | Description | Default | Required |
|-----------|------|-------------|---------|----------|
| `page` | integer | Page number (1-indexed) | 1 | No |
| `pageSize` | integer | Items per page (max 100) | 20 | No |
| `purchased` | boolean | Filter by purchase status (students only) | - | No |

### Request Headers

```
Authorization: Bearer <access_token>
```

### Response (200 OK)

```json
{
  "success": true,
  "data": {
    "items": [
      {
        "id": "550e8400-e29b-41d4-a716-446655440000",
        "title": "Java Spring Boot Mastery",
        "description": "Complete guide to building production-ready applications",
        "price": 99.99,
        "thumbnailUrl": "https://s3.amazonaws.com/waterballsa/thumbnails/java-spring.jpg",
        "isPublished": true,
        "chapterCount": 12,
        "lessonCount": 87,
        "isPurchased": false, // For current user
        "createdAt": "2025-01-01T00:00:00Z"
      }
    ],
    "pagination": {
      "page": 1,
      "pageSize": 20,
      "totalItems": 15,
      "totalPages": 1,
      "hasNext": false,
      "hasPrevious": false
    }
  }
}
```

### Example Requests

```bash
# Get all curriculums (page 1)
GET /api/curriculums

# Get purchased curriculums only
GET /api/curriculums?purchased=true

# Get unpurchased curriculums (catalog)
GET /api/curriculums?purchased=false

# Pagination
GET /api/curriculums?page=2&pageSize=10
```

---

## GET `/api/curriculums/:id`

Get curriculum details with chapters and lessons.

### Path Parameters

| Parameter | Type | Description |
|-----------|------|-------------|
| `id` | UUID | Curriculum ID |

### Request Headers

```
Authorization: Bearer <access_token>
```

### Response (200 OK)

```json
{
  "success": true,
  "data": {
    "id": "550e8400-e29b-41d4-a716-446655440000",
    "title": "Java Spring Boot Mastery",
    "description": "Complete guide to building production-ready applications",
    "price": 99.99,
    "thumbnailUrl": "https://s3.amazonaws.com/waterballsa/thumbnails/java-spring.jpg",
    "isPublished": true,
    "isPurchased": false,
    "chapters": [
      {
        "id": "660e8400-e29b-41d4-a716-446655440000",
        "title": "Introduction to Spring Boot",
        "description": "Get started with Spring Boot basics",
        "orderIndex": 0,
        "lessonCount": 8,
        "lessons": [
          {
            "id": "770e8400-e29b-41d4-a716-446655440000",
            "title": "What is Spring Boot?",
            "type": "VIDEO",
            "orderIndex": 0,
            "videoDuration": 600, // 10 minutes in seconds
            "isCompleted": false // User progress
          }
        ]
      }
    ],
    "createdAt": "2025-01-01T00:00:00Z"
  }
}
```

### Error Response (403 Forbidden)

Students attempting to access unpurchased curriculum details:

```json
{
  "success": false,
  "error": {
    "code": "FORBIDDEN",
    "message": "You must purchase this curriculum to access its content",
    "details": {
      "curriculumId": "550e8400-e29b-41d4-a716-446655440000",
      "price": 99.99
    }
  }
}
```

### Error Response (404 Not Found)

```json
{
  "success": false,
  "error": {
    "code": "NOT_FOUND",
    "message": "Curriculum not found"
  }
}
```

### Notes

- **Students**: Can only view full details of purchased curriculums
- **Unpurchased Content**: Students see 403 Forbidden with purchase info

---

## POST `/api/curriculums/:id/purchase`

Purchase a curriculum (mock payment for Phase 1-3).

### Path Parameters

| Parameter | Type | Description |
|-----------|------|-------------|
| `id` | UUID | Curriculum ID |

### Request Headers

```
Authorization: Bearer <access_token>
```

### Request Body

```json
{
  "mockPaymentId": "mock_1732272000000_abc123", // Generated by frontend
  "cardLast4": "4242" // Mock card info for display
}
```

### Response (201 Created)

```json
{
  "success": true,
  "data": {
    "purchaseId": "880e8400-e29b-41d4-a716-446655440000",
    "curriculumId": "550e8400-e29b-41d4-a716-446655440000",
    "amount": 99.99,
    "paymentProvider": "MOCK",
    "paymentId": "mock_1732272000000_abc123",
    "status": "COMPLETED",
    "purchasedAt": "2025-11-22T10:30:00Z"
  },
  "message": "Curriculum purchased successfully!"
}
```

### Error Response (409 Conflict)

User has already purchased this curriculum:

```json
{
  "success": false,
  "error": {
    "code": "ALREADY_PURCHASED",
    "message": "You have already purchased this curriculum",
    "details": {
      "purchaseId": "880e8400-e29b-41d4-a716-446655440000",
      "purchasedAt": "2025-11-20T15:22:00Z"
    }
  }
}
```

### Error Response (404 Not Found)

```json
{
  "success": false,
  "error": {
    "code": "NOT_FOUND",
    "message": "Curriculum not found"
  }
}
```

### Error Response (400 Bad Request)

```json
{
  "success": false,
  "error": {
    "code": "VALIDATION_ERROR",
    "message": "Invalid payment information",
    "details": {
      "mockPaymentId": "Invalid format"
    }
  }
}
```

### Notes

- **Mock Payment**: Phase 1-3 uses mock payments (no real money)
- **One-Time Purchase**: Users cannot purchase the same curriculum twice
- **Instant Access**: Purchase grants immediate access to all lessons

---

## Business Rules

### Curriculum Visibility

1. **Published Curriculums** (`isPublished = true`):
   - Visible to all users in catalog
   - Can be purchased by students

2. **Unpublished Curriculums** (`isPublished = false`):
   - Not visible to users
   - Cannot be purchased

### Access Control

1. **Students**:
   - Can browse all published curriculums
   - Can only view full details of purchased curriculums
   - Must purchase to access lessons

### Purchase Rules

- **Purchase Unit**: Entire curriculum only (not individual chapters/lessons)
- **One Purchase Per User**: Database unique constraint enforces this
- **Price Lock**: Curriculum price at time of purchase is recorded
- **No Refunds**: All purchases are final (for MVP)

---

## Example Flow

### Student Purchase Flow

```
1. Student browses catalog: GET /api/curriculums
2. Student views curriculum preview (limited info)
3. Student clicks "Purchase for $99.99"
4. Frontend shows mock payment form
5. Student fills mock card details
6. Frontend generates mockPaymentId
7. Frontend calls: POST /api/curriculums/:id/purchase
8. Backend creates purchase record (status = COMPLETED)
9. Backend returns success
10. Frontend redirects to curriculum page
11. Student can now access all lessons
```
